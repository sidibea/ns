!function(e){e.fn.gMap=function(n,a){switch(n){case'addMarker':return e(this).trigger('gMap.addMarker',[a.latitude,a.longitude,a.content,a.icon,a.popup]);case'centerAt':return e(this).trigger('gMap.centerAt',[a.latitude,a.longitude,a.zoom]);case'clearMarkers':return e(this).trigger('gMap.clearMarkers')};var o=e.extend({},e.fn.gMap.defaults,n);return this.each(function(){var a=new google.maps.Map(this);e(this).data('gMap.reference',a);var c=new google.maps.Geocoder;o.address?c.geocode({address:o.address},function(e){e&&e.length&&a.setCenter(e[0].geometry.location)}):o.latitude&&o.longitude?a.setCenter(new google.maps.LatLng(o.latitude,o.longitude)):e.isArray(o.markers)&&o.markers.length>0?o.markers[0].address?c.geocode({address:o.markers[0].address},function(e){e&&e.length>0&&a.setCenter(e[0].geometry.location)}):a.setCenter(new google.maps.LatLng(o.markers[0].latitude,o.markers[0].longitude)):a.setCenter(new google.maps.LatLng(34.885931,9.84375)),a.setZoom(o.zoom),a.setMapTypeId(google.maps.MapTypeId[o.maptype]);var d={scrollwheel:o.scrollwheel,disableDoubleClickZoom:!o.doubleclickzoom};o.controls===!1?e.extend(d,{disableDefaultUI:!0}):0!==o.controls.length&&e.extend(d,o.controls,{disableDefaultUI:!0}),a.setOptions(d),a.setOptions({styles:o.styles});var t,r,s=new google.maps.Marker;t=new google.maps.MarkerImage(o.icon.image),t.size=new google.maps.Size(o.icon.iconsize[0],o.icon.iconsize[1]),t.anchor=new google.maps.Point(o.icon.iconanchor[0],o.icon.iconanchor[1]),s.setIcon(t),o.icon.shadow&&(r=new google.maps.MarkerImage(o.icon.shadow),r.size=new google.maps.Size(o.icon.shadowsize[0],o.icon.shadowsize[1]),r.anchor=new google.maps.Point(o.icon.shadowanchor[0],o.icon.shadowanchor[1]),s.setShadow(r)),e(this).bind('gMap.centerAt',function(e,o,s,n){n&&a.setZoom(n),a.panTo(new google.maps.LatLng(parseFloat(o),parseFloat(s)))});var l=[];e(this).bind('gMap.clearMarkers',function(){for(;l[0];)l.pop().setMap(null)});var g;e(this).bind('gMap.addMarker',function(t,i,p,r,e,h){var d,c,w=new google.maps.LatLng(parseFloat(i),parseFloat(p)),n=new google.maps.Marker({position:w});if(e?(d=new google.maps.MarkerImage(e.image),d.size=new google.maps.Size(e.iconsize[0],e.iconsize[1]),d.anchor=new google.maps.Point(e.iconanchor[0],e.iconanchor[1]),n.setIcon(d),e.shadow&&(c=new google.maps.MarkerImage(e.shadow),c.size=new google.maps.Size(e.shadowsize[0],e.shadowsize[1]),c.anchor=new google.maps.Point(e.shadowanchor[0],e.shadowanchor[1]),s.setShadow(c))):(n.setIcon(s.getIcon()),n.setShadow(s.getShadow())),r){'_latlng'===r&&(r=i+', '+p);var m=new google.maps.InfoWindow({content:o.html_prepend+r+o.html_append});google.maps.event.addListener(n,'click',function(){g&&g.close(),m.open(a,n),g=m}),h&&google.maps.event.addListenerOnce(a,'tilesloaded',function(){m.open(a,n)})};n.setMap(a),l.push(n)});for(var n,p=this,m=function(o){return function(a){a&&a.length>0&&e(p).trigger('gMap.addMarker',[a[0].geometry.location.lat(),a[0].geometry.location.lng(),o.html,o.icon,o.popup])}},i=0;i<o.markers.length;i++)n=o.markers[i],n.address?('_address'===n.html&&(n.html=n.address),c.geocode({address:n.address},m(n))):e(this).trigger('gMap.addMarker',[n.latitude,n.longitude,n.html,n.icon,n.popup])})},e.fn.gMap.defaults={address:'',latitude:0,longitude:0,zoom:1,markers:[],controls:[],styles:[],scrollwheel:!1,doubleclickzoom:!0,maptype:'ROADMAP',html_prepend:'<div class="gmap_marker">',html_append:'</div>',icon:{image:'http://www.google.com/mapfiles/marker.png',shadow:'http://www.google.com/mapfiles/shadow50.png',iconsize:[20,34],shadowsize:[37,34],iconanchor:[9,34],shadowanchor:[6,34]}}}(jQuery);